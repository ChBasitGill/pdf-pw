<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
    <style>
      /* PDF Print Optimizations */
      @media print {
        .page-break {
          page-break-after: always;
        }
        thead {
          display: table-header-group;
        }
        tr {
          page-break-inside: avoid;
        }
        /* Ensures backgrounds render in PDF */
        body {
          -webkit-print-color-adjust: exact;
        }
      }

      /* Custom SEB Branding */
      .bg-seb-dark {
        background-color: #002d47;
      }
      .text-seb-green {
        color: #009245;
      }
      .border-seb-green {
        border-color: #009245;
      }

      /* Chart Styles */
      .line-path {
        fill: none;
        stroke: #009245;
        stroke-width: 3;
      }
      .area-path {
        fill: rgba(0, 146, 69, 0.15);
      }
    </style>
  </head>
  <body class="bg-white">
    <div
      class="page-break h-[290mm] bg-seb-dark text-white p-20 flex flex-col justify-between"
    >
      <div
        class="w-20 h-20 bg-seb-green flex items-center justify-center text-2xl font-bold"
      >
        SEB
      </div>

      <div>
        <h1 class="text-7xl font-bold text-seb-green mb-6">
          {{data.reportTitle}}
        </h1>
        <p class="text-2xl text-slate-300 max-w-2xl leading-relaxed">
          {{data.summary}}
        </p>
      </div>

      <div
        class="border-t border-slate-700 pt-10 flex justify-between items-end"
      >
        <div>
          <p class="text-slate-400 uppercase tracking-widest text-sm">
            Generated At
          </p>
          <p class="text-xl">{{data.generatedAt}}</p>
        </div>
        <div class="text-right">
          <p class="text-slate-400 uppercase tracking-widest text-sm">
            Classification
          </p>
          <p class="text-xl">Internal / Confidential</p>
        </div>
      </div>
    </div>

    <div class="p-12">
      <div
        class="flex justify-between items-center border-b-4 border-seb-green pb-6 mb-12"
      >
        <h2 class="text-3xl font-bold text-seb-dark">Performance Analytics</h2>
        <div class="text-right">
          <p class="text-sm font-bold text-slate-400">TOTAL VOLUME</p>
          <p class="text-2xl font-bold">{{data.totalVolume}}</p>
        </div>
      </div>

      <div class="mb-12 bg-slate-50 p-8 rounded-2xl border border-slate-100">
        <h3 class="text-lg font-bold text-slate-700 mb-6">
          Asset Growth Trend (Vector SVG)
        </h3>
        <div id="chart-container" class="w-full"></div>
      </div>

      <table class="w-full text-left border-collapse">
        <thead>
          <tr class="bg-slate-100 border-b border-slate-200 text-seb-dark">
            <th class="p-4 font-bold uppercase text-xs tracking-wider">ID</th>
            <th class="p-4 font-bold uppercase text-xs tracking-wider">Date</th>
            <th class="p-4 font-bold uppercase text-xs tracking-wider">
              Description
            </th>
            <th
              class="p-4 font-bold uppercase text-xs tracking-wider text-right"
            >
              Amount (EUR)
            </th>
          </tr>
        </thead>
        <tbody class="divide-y divide-slate-100">
          {{#each data.items}}
          <tr>
            <td class="p-4 text-sm font-bold">#{{this.id}}</td>
            <td class="p-4 text-sm text-slate-500">{{this.date}}</td>
            <td class="p-4 text-sm text-slate-600">{{this.description}}</td>
            <td class="p-4 text-sm text-right font-mono font-bold">
              ${{this.amount}}
            </td>
          </tr>
          {{/each}}
        </tbody>
      </table>
    </div>

    <script>
      // Use a safe injection for both Node (Handlebars) and Python (Jinja2)
      // In Node, we'll pass 'items_json'. In Python, we'll pass the same.
      const rawData = {{{items_json}}};

      const container = document.getElementById('chart-container');
      const width = container.offsetWidth || 800;
      const height = 300;
      const margin = {top: 20, right: 30, bottom: 40, left: 50};

      const svg = d3.select("#chart-container")
          .append("svg")
          .attr("viewBox", `0 0 ${width} ${height}`)
          .attr("preserveAspectRatio", "xMinYMin meet")
          .append("g")
          .attr("transform", `translate(${margin.left},${margin.top})`);

      // Scales
      const x = d3.scaleLinear()
          .domain([0, rawData.length - 1])
          .range([0, width - margin.left - margin.right]);

      const y = d3.scaleLinear()
          .domain([0, d3.max(rawData, d => parseFloat(d.amount)) * 1.2])
          .range([height - margin.top - margin.bottom, 0]);

      // Draw Area
      svg.append("path")
          .datum(rawData)
          .attr("class", "area-path")
          .attr("d", d3.area()
              .x((d, i) => x(i))
              .y0(y(0))
              .y1(d => y(parseFloat(d.amount)))
          );

      // Draw Line
      svg.append("path")
          .datum(rawData)
          .attr("class", "line-path")
          .attr("d", d3.line()
              .x((d, i) => x(i))
              .y(d => y(parseFloat(d.amount)))
          );

      // Add Axes
      svg.append("g")
          .attr("transform", `translate(0,${height - margin.top - margin.bottom})`)
          .call(d3.axisBottom(x).ticks(5).tickFormat(i => "Rec " + i))
          .attr("color", "#94a3b8");

      svg.append("g")
          .call(d3.axisLeft(y).ticks(5))
          .attr("color", "#94a3b8");
    </script>
  </body>
</html>
